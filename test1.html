<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Test 1</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r110/three.min.js"></script>
  <style>
    .checkbox-container {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: grid;
      grid-template-columns: repeat(2, auto);
      grid-gap: 10px;
      z-index: 1;
    }

    .checkbox-row {
      display: flex;
      justify-content: space-between;
    }

    .checkbox-row label {
      margin: 0;
    }
  </style>
</head>

<body>
  <a-scene>
    <a-sky color="grey"></a-sky>

    <a-camera position="0 0 0">
      <a-cursor></a-cursor>
    </a-camera>

    <a-entity id="sphere-container"></a-entity>

    <div class="checkbox-container">
      <div class="checkbox-row">
        <label><input type="checkbox" id="checkbox1"> Option 1</label>
        <label><input type="checkbox" id="checkbox2"> Option 2</label>
      </div>
      <div class="checkbox-row">
        <label><input type="checkbox" id="checkbox3"> Option 3</label>
        <label><input type="checkbox" id="checkbox4"> Option 4</label>
      </div>
      <div class="checkbox-row">
        <label><input type="checkbox" id="checkbox5"> Option 5</label>
        <label><input type="checkbox" id="checkbox6"> Option 6</label>
      </div>
      <div class="checkbox-row">
        <label><input type="checkbox" id="checkbox7"> Option 7</label>
        <label><input type="checkbox" id="checkbox8"> Option 8</label>
      </div>
    </div>

  </a-scene>
  <script>
    const jsonUrl = "mix064097.json";

    let currentlyPlayingSound = null;
    let startTime = null;

    function logDurationAndStopSound() {
      if (currentlyPlayingSound) {
        currentlyPlayingSound.components.sound.stopSound();
        const endTime = new Date();
        const duration = (endTime - startTime) / 1000; // Duration in seconds
        const soundPath = currentlyPlayingSound.getAttribute('src');
        console.log(`Duration: ${duration}s, Audio Path: ${soundPath}`);
        startTime = null;
        currentlyPlayingSound = null;
      }
    }

    function loadAndCreateSpheres(url) {
      fetch(url)
        .then((response) => response.json())
        .then((data) => {
          const container = document.getElementById("sphere-container");
          const radius = 200; // Radius of the cylinder
          const maxX = Math.max(...data.map(item => item.point[0]));
          const minX = Math.min(...data.map(item => item.point[0]));
          const rangeX = maxX - minX;

          data.forEach((item) => {
            const point = item.point;
            const soundPath = item.path;
            const x2d = point[0];
            const y2d = point[1];

            // Convert 2D coordinates to cylindrical coordinates
            const theta = ((x2d - minX) / rangeX) * 2 * Math.PI;
            const x3d = radius * Math.cos(theta);
            const z3d = radius * Math.sin(theta);
            const y3d = y2d; // Use y2d directly for the y-coordinate

            const sphere = document.createElement("a-sphere");
            sphere.setAttribute("position", `${x3d} ${y3d} ${z3d}`);
            sphere.setAttribute("radius", "2");
            sphere.setAttribute("color", "red");

            const sound = document.createElement("a-sound");
            sound.setAttribute("src", soundPath);
            sound.setAttribute("autoplay", "false");
            sound.setAttribute("volume", "50");

            sphere.appendChild(sound);
            container.appendChild(sphere);

            sphere.addEventListener("click", () => {
              if (currentlyPlayingSound === sound) {
                sound.components.sound.stopSound();
                startTime = null;
                currentlyPlayingSound = null;
              } else {
                logDurationAndStopSound();
                sound.components.sound.playSound();
                currentlyPlayingSound = sound;
                startTime = new Date();
              }
              // Log the audio path when the sphere is clicked
              console.log(`${soundPath}`);
            });

            // Handle the end of the sound
            sound.addEventListener('sound-ended', () => {
              logDurationAndStopSound();
            });
          });
        })
        .catch((error) => console.error("Error loading JSON:", error));
    }

    loadAndCreateSpheres(jsonUrl);
  </script>
</body>

</html>
